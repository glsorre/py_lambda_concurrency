<html>
	<head>
        <link rel="stylesheet" href="https://cdn.rawgit.com/hakimel/reveal.js/3.9.2/css/reset.css">
		<link rel="stylesheet" href="https://cdn.rawgit.com/hakimel/reveal.js/3.9.2/css/reveal.css">
        <link rel="stylesheet" href="https://cdn.rawgit.com/hakimel/reveal.js/3.9.2/css/theme/white.css">
        <link rel="stylesheet" href="https://cdn.rawgit.com/hakimel/reveal.js/master/lib/css/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown>
                    <textarea data-template>
                        ## Unleash the power of concurrency in AWS lambdas
                
                        How, when and if use python concurrency in AWS lambdas
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Me
                
                        - UI Engineer at [hotels.com](https://hotels.com)
                        - Indie Developer and Blogger at [rightright.me](https://rightright.me)
                        - @glsorre on [github](https://github.com/glsorre) and [twitter](https://twitter.com/glsorre)
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Agenda
                
                        - introduction to AWS lambdas
                        - tasks: CPU and I/O bounded 
                        - python concurrency: threads and processes
                        - code diving
                        - data presentation
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### AWS lambdas

                        > lets you run code without provisioning or managing servers
                        - 15 minutes limit
                        - scalable
                        - python first-citizen
                        - performance grow with memory assigned
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Tasks: CPU and I/O bounded

                        > a task is CPU bound if it would go faster if the CPU were faster

                        > a task is I/O bound if it would go faster if the I/O subsystem was faster
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Tasks: big O

                        $$ O(n^2) $$ &rarr; selection sort

                        $$ O(\log{}n) $$ &rarr; quick sort
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Python Concurrency

                        - threads
                        - processes
                        - ~~asyncio~~
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Python Concurrency

                        ##### threads
                        
                        - lightweight
                        - shares memory
                        - inside the GIL
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Python Concurrency

                        ##### processes
                        
                        - separate memory space
                        - can use multiple CPU cores
                        - outside the GIL
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Python Concurrency

                        ##### summary

                        ![thread](assets/thread.png "Thread")
                        ![process](assets/process.png "Process")
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Python Concurrency

                        ##### batteries included

                        concurrent.futures:
                        - ThreadPoolExecutor
                        - ~~ProcessPoolExecutor~~
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Python Concurrency

                        ##### my processpool implementation

                        ```
from multiprocessing import Process
from threading import current_thread, Thread
from queue import Queue

def _run(q):
    while True:
        p = q.get()
        if p is None:
            break
        p.start()
        p._popen.wait()
        q.task_done()

class Pool:
    def __init__(self, max_workers):
        self.max_workers = max_workers
        self.threads = []
        self.queue = Queue()

    def map(self, func, args):
        for i in range(self.max_workers):
            t = Thread(target=_run, args=(self.queue, ))
            t.start()
            self.threads.append(t)

        for a in args:
            self.queue.put(Process(target=func, args=(a, )))

        self.queue.join()

        for i in range(self.max_workers):
            self.queue.put(None)

    def close(self):
        for t in self.threads:
            t.join()
                        ```
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Tasks Tested

                        - **selection sort** &rarr; cpu_bounded_func
                        - **quick sort** &rarr; cpu_bounded_func_quick
                        - **url get** &rarr; io_bounded_func
                        
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Results

                        ![thread](assets/cpu_bounded_func_memory.png "Thread")
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Results

                        ![thread](assets/cpu_bounded_func_tot_number.png "Thread")
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Results

                        ![thread](assets/io_bounded_func_memory.png "Thread")
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Results

                        ![thread](assets/io_bounded_func_tot_number.png "Thread")
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Results

                        ![thread](assets/cpu_bounded_func_quick_memory.png "Thread")
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Conclusions

                        - 
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Thanks

                        [https://github.com/glsorre/py_lambda_concurrency](https://github.com/glsorre/py_lambda_concurrency)
                    </textarea>
                </section>
                <section data-markdown>
                    <textarea data-template>
                        ### Questions

                    </textarea>
                </section>
			</div>
        </div>
        <script src="https://cdn.rawgit.com/hakimel/reveal.js/3.9.2/js/reveal.js"></script>
        <script src="https://cdn.rawgit.com/hakimel/reveal.js/3.9.2/plugin/markdown/marked.js"></script>
        <script src="https://cdn.rawgit.com/hakimel/reveal.js/3.9.2/plugin/markdown/markdown.js"></script>
		<script>
			Reveal.initialize({
                // Options which are passed into marked
                // See https://marked.js.org/#/USING_ADVANCED.md#options
                hash: true,
                progress: true,
	            slideNumber: true,
                markdown: {
                    smartypants: true
                },
                math: {
                    mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                    config: 'TeX-AMS_HTML-full', // See http://docs.mathjax.org/en/latest/config-files.html
                    // pass other options into `MathJax.Hub.Config()`
                    TeX: { Macros: { RR: "{\\bf R}" } }
                },
                dependencies: [
                    { src: 'https://cdn.rawgit.com/hakimel/reveal.js/3.9.2/plugin/math/math.js', async: true },
                    { src: 'https://cdn.rawgit.com/hakimel/reveal.js/3.9.2/plugin/highlight/highlight.js', async: true }
                ]
            });
		</script>
	</body>
</html>